<!DOCTYPE html>
<html>
<head>
	<title>Tic Tac Toe</title>
	<style>
		body {
			font-family: Arial, sans-serif;
		}

		h1 {
			text-align: center;
		}

		#board {
			display: flex;
			flex-wrap: wrap;
			justify-content: center;
			align-items: center;
			width: 620px;
			height: 620px;
			margin: 0 auto;
			border: 8px solid #000;
			border-radius: 8px;
			overflow: hidden;
		}

		.cell {
			display: flex;
			justify-content: center;
			align-items: center;
			width: 200px;
			height: 200px;
			font-size: 100px;
			cursor: pointer;
			box-sizing: border-box;
			background-color: #fff;
			border: 2px solid #000;
			box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.3);
			transition: background-color 0.2s ease-in-out;
		}

		.cell:hover {
			background-color: #f9f9f9;
		}

		.cell.clicked {
			background-color: #ddd;
			cursor: not-allowed;
		}

		.endgame {
			display: none;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background-color: rgba(255, 255, 255, 0.9);
			padding: 20px;
			border-radius: 10px;
			box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.3);
		}

		.endgame .text {
			font-size: 32px;
			font-weight: bold;
			text-align: center;
			margin-bottom: 20px;
		}

		.restart-btn {
			background-color: #4CAF50;
			color: white;
			padding: 10px 20px;
			border: none;
			border-radius: 5px;
			font-size: 16px;
			cursor: pointer;
			float: right;
		}
	</style>
</head>
<body>
	<h1>Tic Tac Toe</h1>
	<div id="board">
		<div class="cell" id="0"></div>
		<div class="cell" id="1"></div>
		<div class="cell" id="2"></div>
		<div class="cell" id="3"></div>
		<div class="cell" id="4"></div>
		<div class="cell" id="5"></div>
		<div class="cell" id="6"></div>
		<div class="cell" id="7"></div>
		<div class="cell" id="8"></div>
	</div>
	<div class="endgame">
		<div class="text"></div>
		<button class="restart-btn" onclick="startGame()">Restart</button>
	</div>

	<script>
		var origBoard;
		const huPlayer = 'O';
		const aiPlayer = 'X';
		const winCombos = [
			[0,1,2],
			[3,4,5],
			[6,7,8],
			[0,3,6],
			[0,4,8],
			[1,4,7],
			[2,5,8],
			[6,4,2],
		];

		const cells = document.querySelectorAll('.cell');
		startGame();

		function startGame(){
			document.querySelector(".endgame").style.display = 'none'
			origBoard = Array.from(Array(9).keys());
			console.log(origBoard);
			for (var i = 0; i < cells.length; i++) {
				cells[i].innerText = '';
				cells[i].style.removeProperty('background-color');
				cells[i].addEventListener('click', turnClick, false);
			}
		}

		function turnClick(square){
			if(typeof origBoard[square.target.id] == 'number') {
				turn(square.target.id, huPlayer)
				if(!checkTie()) turn(bestSpot(), aiPlayer);
			}
		}

		function turn(squareId, player){
			origBoard[squareId] = player;
			document.getElementById(squareId).innerText = player;
			let gameWon = checkWin(origBoard,player);
if(gameWon) gameOver(gameWon);
}	function checkWin(board, player){
		let plays = board.reduce((acc, elem, index) => 
			(elem === player)?acc.concat(index):acc, []);
		let gameWon = null;
		for(let [index, win] of winCombos.entries()){
			if (win.every(elem => plays.indexOf(elem) > -1)){
				gameWon = {index: index, player: player};
				break;
			}
		}
		return gameWon;
	}

	function declareWinner(who){
		document.querySelector('.endgame').style.display = "block";
		document.querySelector('.endgame .text').innerText = who;
	}

	function gameOver(gameWon){
		for(let index of winCombos[gameWon.index]){
			document.getElementById(index).style.backgroundColor = (gameWon.player == huPlayer) ? "blue" : "red";
		}
		for (var i = 0; i < cells.length; i++) {
			cells[i].removeEventListener('click', turnClick, false);
		}
		declareWinner(gameWon.player == huPlayer ? 'You win!' : 'You lose!');
	}

	function emptySquares(){
		return origBoard.filter(s => typeof s == 'number');
	}

	function bestSpot(){
		return minimax(origBoard, aiPlayer).index;
	}

	function checkTie(){
		if (emptySquares().length == 0) {
			for (var i = 0; i < cells.length; i++) {
				cells[i].style.backgroundColor = "green";
				cells[i].removeEventListener('click', turn, false);
			}

			declareWinner("Tie Game!")
			return true;
		}
		return false;
	}

	function minimax(newBoard, player){
		var availSpots = emptySquares(newBoard);

		if (checkWin(newBoard, player)) {
			return {score: -10};
		}
		else if (checkWin(newBoard, aiPlayer)) {
			return {score: 10};	
		}
		else if(availSpots.length === 0){
			return {score: 0};
		}
		var moves = [];
		for (var i = 0; i < availSpots.length; i++) {
			var move = {};
			move.index = newBoard[availSpots[i]];
			newBoard[availSpots[i]] = player;

			if (player == aiPlayer) {
				var result = minimax(newBoard, huPlayer);
				move.score = result.score;
			}
			else {
				var result = minimax(newBoard, aiPlayer);
				move.score = result.score;
			}

			newBoard[availSpots[i]] = move.index;

			moves.push(move);
		}

		var  bestMove;
		if (player === aiPlayer) {
			var bestScore = -10000;
			for (var i = 0; i < moves.length; i++) {
				if (moves[i].score > bestScore) {
					bestScore = moves[i].score;
					bestMove = i;
				}
			}
		}
		else {
			var bestScore = 10000;
			for (var i = 0; i < moves.length; i++) {
				if (moves[i].score < bestScore) {
					bestScore = moves[i].score;
					bestMove = i;
				}
			}
		}

		return moves[bestMove];
	}

</script>
</body>
</html>